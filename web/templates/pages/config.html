{{ define "config" }}
    {{ template "start" .nav }}

    <div class="container pl-32 pr-12 mx-auto pt-10">
        {{ template "page-title" dict "Title" "Configuration" "Icon" "file-settings-variant"}}

        {{ template "errors" .errors }}
        {{ template "success" .success }}

        <div class="w-full p-6 mb-10 flex items-center bg-white rounded-xl border border-gray-300">
            <div class="mr-4">
                <div class="flex items-center justify-center w-10 h-10 rounded-xl bg-orange-100">
                    <span class="mdi mdi-alert-box text-2xl text-yellow-500"></span>
                </div>
            </div>
            <div class="flex flex-col">
                <p class="text-blue-900 text-sm font-semibold">
                    When saving the configuration, Memento will exit in order to apply the new settings. If you're running in docker, it should be restarted automatically
                </p>
            </div>
        </div>

        <form method="post" action="/config" class="mt-4">
            <div class="flex flex-wrap items-stretch -mx-4">
                {{ template "recursive-config" dict "Value" .settings "Step" 0 "uid" "" }}
            </div>

            <div class="my-2 flex">

                {{ template "form-button" "Save & restart" }}

                <input type="reset"
                       class="px-4 py-2 mx-2 font-bold text-sm text-blue-900 border border-transparent bg-transparent cursor-pointer" value="Revert changes">
            </div>
        </form>
    </div>

    {{ template "end" }}
{{ end }}


{{ define "recursive-config" }}
    {{ $step := .Step }}
    {{ $uid := .uid }}
    {{ range $key, $value := .Value }}
        {{ if isMap $value }}
            {{ if eq $step 0 }}
                <div class="p-4 w-1/4 flex">
                    <div class="rounded-xl p-6 bg-white w-full border border-gray-300">
                        <p class="font-semibold mb-4 uppercase text-blue-900">{{ $key }}</p>

                        {{ template "recursive-config" dict "Value" $value "Step" (plus $step 1) "uid" (printf "%s.%s" $uid $key) }}
                    </div>
                </div>
            {{ else }}
                <div class="ml-{{ times (plus $step -1) 4 }} my-4">
                    <p class="text-blue-900 text-sm font-semibold">{{ $key }}</p>

                    {{ template "recursive-config" dict "Value" $value "Step" (plus $step 1) "uid" (printf "%s.%s" $uid $key) }}
                </div>
            {{ end}}
        {{ else }}
            {{ if eq $step 0 }}
                <div class="p-4 w-1/4 flex">
                    <div class="rounded-xl p-6 bg-white w-full border border-gray-300">
                        <p class="font-semibold mb-4 uppercase text-blue-900">{{ $key }}</p>

                        {{ template "config-value" dict "Label" $key "Value" $value "Step" $step "uid" (printf "%s.%s" $uid $key) }}
                    </div>
                </div>
            {{ else }}
                {{ template "config-value" dict "Label" $key "Value" $value "Step" $step "uid" (printf "%s.%s" $uid $key) }}
            {{ end }}
        {{ end }}
    {{ end }}
{{ end }}

{{ define "config-value" }}
    <div class="flex flex-col ml-{{ times (plus .Step -1) 4 }} my-3">
        <p class="text-gray-500 text-sm">{{ .Label }}</p>

        {{ if eq (printf "%T" .Value) "bool" }}
            <label for="toogle{{ .uid }}" class="flex items-center cursor-pointer my-2">
                <div class="relative">
                    <input id="toogle{{ .uid }}" type="checkbox"
                           class="hidden" {{ if eq .Value true }} checked {{end}} name="{{ .uid }}"/>
                    <!-- line -->
                    <div class="toggle__line w-10 h-4 bg-gray-400 rounded-full shadow-inner"></div>
                    <!-- dot -->
                    <div class="toggle__dot absolute w-6 h-6 bg-gray-500 rounded-full shadow inset-y-0 left-0"></div>
                </div>
            </label>
        {{ else }}
            <input type="text" value="{{ .Value }}" name="{{ .uid }}"
                   class="w-full px-4 py-2 border border-gray-300 hover:border-blue-500 focus:border-blue-500 transition rounded text-blue-900 text-sm">
        {{ end }}
    </div>
{{ end }}